/******************************************************************************
* 项目名称 ： 外部中断实验
* 作者     ： 郑朋桥
* 日期     ： 2016/08/01
******************************************************************************/

/******************************************************************************
*导入头文件
******************************************************************************/
#include <ioCC2530.h>
#include "LED.h"
#include "INTKEY.h"

int status = 0;  //记录闪烁状态

/*****************************************************************************
*函数声明
*****************************************************************************/

/*****************************************************************************
*  函数介绍  ： IS1的回调函数
*            ：
*    参数    ： 无
*   返回值   ： 无
******************************************************************************/
void IS1_func()
{
  status = 1;
}

/*****************************************************************************
*  函数介绍  ： IS2的回调函数
*            ：
*    参数    ： 无
*   返回值   ： 无
******************************************************************************/
void IS2_func()
{
  status = 0;
}

/*****************************************************************************
*函数含义：不精确延迟函数
*函数参数：延迟毫秒数
*  返回值：无返回值
*****************************************************************************/
void delayMS(int ms)
{
  int i,j;
  for(i = 0; i < ms; i++)
  {
    for(j = 0; j < 535; j++);
  }
}

/*****************************************************************************
*LED闪烁函数
*****************************************************************************/
void ledMagic()
{
  led1On();
  led2Off();
  delayMS(200);
  led1Off();
  led2On();
  delayMS(200);
}

void ledOff()
{
  led1Off();
  led2Off();
 }

void main()
{
  ledInit();                //初始化LED
  intKeyInit();             //初始化按键
  setIntKey1Fun(IS1_func);  //设置按键1的回调函数
  setIntKey2Fun(IS2_func);  //设置按键2的回调函数
  while(1)
  {
    if(status == 1)
    {
       ledMagic();
    }
    else
    {
      ledOff();
    }
  }
}
